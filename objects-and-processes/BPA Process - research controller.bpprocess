<process name="research controller" version="1.0" bpversion="7.5.0.17125" cpeversion="10.0.110.0" narrative="Execute one autonomous research run from a seed URL, using memory + AI, and stop correctly.&#xA;&#xA;No saving to disk yet. Results live in memory/logs." byrefcollection="true" processrunningmessage="" disableversioning="false" preferredid="601753b5-de98-4df3-a5bf-89411ea9b6c8">
  <view>
    <camerax>11</camerax>
    <cameray>75</cameray>
    <zoom version="2">3.75</zoom>
  </view>
  <preconditions />
  <endpoint narrative="" />
  <stage stageid="a57b01d3-3564-4608-8d7c-8f2abb275a02" name="Start" type="Start">
    <display x="-75" y="-240" />
    <inputs>
      <input type="text" name="Research_Question" stage="Research_Question" />
      <input type="text" name="Seed_URL" stage="Seed_URL" />
      <input type="number" name="Max_Pages" stage="Num_Pages" />
      <input type="number" name="Page_Count" stage="Page_Count" />
    </inputs>
    <onsuccess>bb1a1217-fab5-4a07-a1db-b893e76c5826</onsuccess>
  </stage>
  <stage stageid="54853172-76f1-43a9-8ae5-7fd1763f11a2" name="End" type="End">
    <display x="30" y="135" />
  </stage>
  <stage stageid="4db8ed61-6205-4bd3-877d-df247150f32c" name="Stage1" type="ProcessInfo">
    <display x="-195" y="-105" w="150" h="120" />
  </stage>
  <stage stageid="c68bdbbd-4eef-4c92-872a-22f779654fb0" name="Visited_URLs" type="Collection">
    <display x="75" y="-300" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
    <collectioninfo>
      <field name="URL" type="text" />
      <field name="is_processed" type="flag" />
      <field name="is_visited" type="flag" />
    </collectioninfo>
  </stage>
  <stage stageid="5865d977-0824-4089-9e8e-94c7843d1526" name="Links" type="Collection">
    <display x="75" y="-345" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d9d8e23a-f7d7-4e48-bc1e-802642f73602" name="Research_Question" type="Data">
    <loginhibit onsuccess="true" />
    <display x="-195" y="-255" w="90" h="30" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">What lies at the center of a black hole?</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="fd98012e-1c67-4938-bfd9-1ea9c6efb83a" name="Max_Results" type="Data">
    <loginhibit onsuccess="true" />
    <display x="-195" y="-300" w="90" h="30" />
    <datatype>number</datatype>
    <initialvalue>20</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3a06d0ea-9b6a-4e87-8247-ead7ae76b0a5" name="Final_Report" type="Data">
    <loginhibit onsuccess="true" />
    <display x="-75" y="-300" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2ad29e5b-e57c-4df3-93e2-cf6b151374d0" name="Search_Results" type="Collection">
    <display x="-75" y="-345" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c130c776-c46e-4213-8096-67fc36f38fd5" name="Result_Count" type="Data">
    <loginhibit onsuccess="true" />
    <display x="-195" y="-210" w="90" h="30" />
    <datatype>number</datatype>
    <initialvalue>0</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0c35c7f4-7196-4f03-85b4-62a2b1a025f9" name="Raw_HTML" type="Data">
    <loginhibit onsuccess="true" />
    <display x="0" y="-300" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d1b653b2-e7a2-407c-bc2d-d90ea66efa19" name="Clean_Text" type="Data">
    <loginhibit onsuccess="true" />
    <display x="150" y="-345" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d4065835-e1fe-44ed-acb6-5ab076ad78b3" name="AI_Result" type="Data">
    <loginhibit onsuccess="true" />
    <display x="150" y="-300" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d4359e06-998f-4ab6-b554-2d0d148be3d8" name="Error_Message" type="Data">
    <loginhibit onsuccess="true" />
    <display x="0" y="-345" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0da925c0-f1a8-4077-9c15-1bbb3e1c3589" name="Page Analyses" type="Collection">
    <display x="225" y="-345" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="94f3ae06-b894-4b63-bba2-fe45d297269d" name="AI_Success" type="Data">
    <loginhibit onsuccess="true" />
    <display x="225" y="-300" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="fe23507c-6bad-4345-b677-54e006bd4738" name="Process Inputs" type="Block">
    <loginhibit onsuccess="true" />
    <narrative>Sample for now, but will be from the queue</narrative>
    <display x="-270" y="-375" w="150" h="195" />
    <font family="Segoe UI" size="10" style="Regular" color="7FB2E5" />
  </stage>
  <stage stageid="bb1a1217-fab5-4a07-a1db-b893e76c5826" name="Launch Browser" type="Action">
    <loginhibit onsuccess="true" />
    <display x="30" y="-240" w="90" h="30" />
    <inputs>
      <input type="text" name="Research_Q" friendlyname="Research_Q" expr="[Research_Question]" />
    </inputs>
    <onsuccess>354a95e7-c0e0-47ee-bc6d-e744a6dfb1f0</onsuccess>
    <resource object="browser control" action="launch browser" />
  </stage>
  <stage stageid="354a95e7-c0e0-47ee-bc6d-e744a6dfb1f0" name="Browser Scrapes " type="Action">
    <loginhibit onsuccess="true" />
    <display x="150" y="-240" w="90" h="30" />
    <outputs>
      <output type="collection" name="headers" friendlyname="headers" stage="Read_Headers" />
      <output type="collection" name="url collection" friendlyname="url collection" stage="Read_URLs" />
    </outputs>
    <onsuccess>ce267a0f-b614-4700-911f-f00d7f2e87fe</onsuccess>
    <resource object="browser control" action="get parent html" />
  </stage>
  <stage stageid="61b333d6-13f6-4394-a7e6-397b899d917b" name="Read_Headers" type="Collection">
    <display x="255" y="-240" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
    <collectioninfo>
      <field name="Index" type="number" />
      <field name="HeaderText" type="text" />
    </collectioninfo>
  </stage>
  <stage stageid="1f67ddd6-3fec-4340-b6d4-f2091443037b" name="Read_URLs" type="Collection">
    <display x="255" y="-180" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
    <collectioninfo>
      <field name="Index" type="number" />
      <field name="URL" type="text" />
    </collectioninfo>
  </stage>
  <stage stageid="f1959753-bc29-4c19-810e-1da7323ef30b" name="Iterating URLs" type="LoopEnd">
    <loginhibit onsuccess="true" />
    <display x="150" y="0" w="90" h="30" />
    <onsuccess>e1085586-d660-491b-b4d5-842f6477143e</onsuccess>
    <groupid>7cc3041b-b2ba-4fa2-a335-f4f349bb0aab</groupid>
  </stage>
  <stage stageid="ce267a0f-b614-4700-911f-f00d7f2e87fe" name="Iterating URLs" type="LoopStart">
    <loginhibit onsuccess="true" />
    <display x="150" y="-180" w="90" h="30" />
    <onsuccess>0987ca94-b1a0-4722-95f5-531fcf240ab7</onsuccess>
    <groupid>7cc3041b-b2ba-4fa2-a335-f4f349bb0aab</groupid>
    <looptype>ForEach</looptype>
    <loopdata>Read_URLs</loopdata>
  </stage>
  <stage stageid="0987ca94-b1a0-4722-95f5-531fcf240ab7" name="Navigating to URL" type="Action">
    <loginhibit onsuccess="true" />
    <display x="30" y="-180" w="90" h="30" />
    <inputs>
      <input type="text" name="URL" friendlyname="URL" expr="[Read_URLs.URL]" />
    </inputs>
    <onsuccess>53245e6b-0646-4f19-b62d-0f6e5882b9e7</onsuccess>
    <resource object="browser control" action="navigate to url" />
  </stage>
  <stage stageid="53245e6b-0646-4f19-b62d-0f6e5882b9e7" name="Extracting Content" type="Action">
    <loginhibit onsuccess="true" />
    <display x="30" y="-120" w="90" h="30" />
    <inputs>
      <input type="text" name="target url" friendlyname="target url" expr="[Read_URLs.URL]" />
    </inputs>
    <outputs>
      <output type="text" name="page text" friendlyname="page text" stage="Page Content" />
    </outputs>
    <onsuccess>eee835d3-92bc-4f40-952a-8527825c18d9</onsuccess>
    <resource object="browser control" action="extract content" />
  </stage>
  <stage stageid="f2d03ca3-5cfe-496b-a1b6-e527f95e31ed" name="Page Content" type="Data">
    <loginhibit onsuccess="true" />
    <display x="255" y="-120" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b9d01562-70ea-41d0-98f1-a87c8f6b0abb" name="Content Set" type="Collection">
    <display x="-75" y="-180" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
    <collectioninfo>
      <field name="Index" type="number" />
      <field name="URL" type="text" />
      <field name="Content" type="text" />
    </collectioninfo>
  </stage>
  <stage stageid="79dbb504-4dd5-4c75-8431-5a36e0829b6e" name="Num_Pages" type="Data">
    <loginhibit onsuccess="true" />
    <display x="-195" y="-345" w="90" h="30" />
    <datatype>number</datatype>
    <initialvalue>5</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="eee835d3-92bc-4f40-952a-8527825c18d9" name="Adding Row" type="Action">
    <loginhibit onsuccess="true" />
    <display x="150" y="-120" w="90" h="30" />
    <inputs>
      <input type="text" name="Collection Name" friendlyname="Collection Name" narrative="The name of the collection to act upon" expr="&quot;Content Set&quot;" />
    </inputs>
    <onsuccess>e108b8d5-d315-446f-8e8a-ef2f65777383</onsuccess>
    <resource object="Blueprism.AutomateProcessCore.clsCollectionActions" action="Add Row" />
  </stage>
  <stage stageid="e108b8d5-d315-446f-8e8a-ef2f65777383" name="Adding Content" type="MultipleCalculation">
    <loginhibit onsuccess="true" />
    <display x="150" y="-60" w="90" h="30" />
    <onsuccess>56aad193-5cab-433d-861b-2488e935fb33</onsuccess>
    <steps>
      <calculation expression="[Read_URLs.Index]" stage="Content Set.Index" />
      <calculation expression="[Read_URLs.URL]" stage="Content Set.URL" />
      <calculation expression="[Page Content]" stage="Content Set.Content" />
    </steps>
  </stage>
  <stage stageid="524a4d37-6736-4cb3-bbd9-fd1bb587c8eb" name="Extraction Loop" type="Block">
    <loginhibit onsuccess="true" />
    <display x="-30" y="-210" w="240" h="240" />
    <font family="Segoe UI" size="10" style="Regular" color="7FB2E5" />
  </stage>
  <stage stageid="56aad193-5cab-433d-861b-2488e935fb33" name="Cleaning Data Item" type="Calculation">
    <loginhibit onsuccess="true" />
    <display x="30" y="-60" w="90" h="30" />
    <onsuccess>e1085586-d660-491b-b4d5-842f6477143e</onsuccess>
    <calculation expression="&quot;&quot;" stage="Page Content" />
  </stage>
  <stage stageid="ef41d598-0dbd-422b-b1d4-88f9707ce305" name="AI Client" type="Block">
    <loginhibit onsuccess="true" />
    <display x="-30" y="45" w="240" h="60" />
    <font family="Segoe UI" size="10" style="Regular" color="7FB2E5" />
  </stage>
  <stage stageid="e1085586-d660-491b-b4d5-842f6477143e" name="Formatting Prompt" type="Action">
    <loginhibit onsuccess="true" />
    <display x="150" y="75" w="90" h="30" />
    <inputs>
      <input type="collection" name="content_collection" friendlyname="content_collection" expr="[Content Set]" />
      <input type="collection" name="headers_collection" friendlyname="headers_collection" expr="[Read_Headers]" />
      <input type="text" name="search_query" friendlyname="search_query" expr="[Research_Question]" />
    </inputs>
    <outputs>
      <output type="text" name="Chat_Request" friendlyname="Chat_Request" stage="Chat_Request" />
    </outputs>
    <onsuccess>4a274c1b-ebec-4d97-ac93-3f3ba78fbfec</onsuccess>
    <resource object="ai client" action="format_prompt" />
  </stage>
  <stage stageid="ade1365c-1ad0-4c18-80ae-716460a9f849" name="Chat_Request" type="Data">
    <loginhibit onsuccess="true" />
    <display x="255" y="75" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4a274c1b-ebec-4d97-ac93-3f3ba78fbfec" name="API Call" type="Action">
    <loginhibit onsuccess="true" />
    <display x="30" y="75" />
    <inputs>
      <input type="text" name="Chat_Request" friendlyname="Chat_Request" expr="[Chat_Request]" />
    </inputs>
    <outputs>
      <output type="text" name="AI_Response" friendlyname="AI_Response" stage="AI_Response" />
    </outputs>
    <onsuccess>54853172-76f1-43a9-8ae5-7fd1763f11a2</onsuccess>
    <resource object="ai client" action="api_call" />
  </stage>
  <stage stageid="d7995603-6941-4010-9b36-d74bfbd51126" name="AI_Response" type="Data">
    <loginhibit onsuccess="true" />
    <display x="-90" y="75" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
</process>